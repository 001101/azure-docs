---
title: Core concepts in device provisioning | Microsoft Docs
description: Describes device provisioning concepts in Azure with DPS and IoT Hub
services: iot-dps
keywords: 
author: nberdy
ms.author: nberdy
ms.date: 08/22/2017
ms.topic: article
ms.service: iot-dps

documentationcenter: ''
manager: timlt
ms.devlang: na
ms.custom: mvc

---

# Core concepts in device provisioning

IoT Hub Device Provisioning Service is a helper service for IoT Hub hat you use to configure zero-touch device provisioning to a specified IoT hub. With IoT DPS you can provision millions of devices in a secure and scalable manner.

Device provisioning  is a two part process. The first part is establishing the initial connection between the device and the IoT solution by *registering* the device. The second part is applying the proper *configuration* to the device based on the specific requirements of the solution it was registered to. Only once both those two steps have been completed can I say that the device has been fully *provisioned*. IoT DPS automates these both steps to provide a seamless provisioning experience for the device. This article gives an overview of the concepts involved in device provisioning both on the device and on the service.

## Device concepts

This section discusses the provisioning concepts most applicable to *devices*. This section is most relevant to personas involved in the [manufacture step](about-iot-dps.md#manufacture-step) of getting a device ready for deployment.

### Attestation mechanism

The attestation mechanism is the method used for confirming a device's identity. The attestation mechanism is also relevant to the enrollment list, which tells the DPS which method of attestation to use with a given device.

> [!NOTE]
> IoT Hub uses "authentication scheme" for a similar concept in that service.

DPS supports two forms of attestation:
* **x509 certificates** based on the standard x509 certificate authentication flow.
* **SAS tokens** based on a nonce challenge using the TPM standard for keys. This does not require a physical TPM on the device, but the service expects to attest using the endorsement key per the [TPM spec](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/).

### Hardware security module

The hardware security module, or HSM, is used for secure, hardware-based storage of device secrets, and is the most secure form of secret storage. Both x509 certificates and SAS tokens can be stored in the HSM. HSMs can be used with both attestation mechanisms the DPS supports.

> [!TIP]
> We strongly recommend using an HSM with devices to securely store secrets on your devices.

Device secrets may also be stored in software (memory), but it is a less secure form of storage than an HSM.

### Registration ID

The registration ID is used to uniquely identify a device in DPS. The device ID must be unique in the DPS [ID scope](#id-scope). Each device must have a registration ID. The registration ID is alphanumeric, lowercase, and may contain hyphens.

* In the case of TPM, the registration ID is provided by the TPM itself.
* In the case of x509-based attestation, the registration ID is provided as the subject name of the certificate.

### Device ID

The device ID is the ID as it appears in IoT Hub. The desired device ID may be set in the enrollment entry, but it is not required to be set. If no desired device ID is specified in DPS, the registration ID is used as the device ID when registering the device. Learn more about [device IDs in IoT Hub](../iot-hub/iot-hub-devguide-identity-registry.md).

### ID scope

The ID scope is assigned to a DPS when it is created by the user and is used to uniquely identify the specific DPS the device will register through. The ID scope is generated by the service and is immutable, which guarantees uniqueness.

> [!NOTE]
> Uniqueness is important for long-running deployment operations and merger and acquisition scenarios.

## Service concepts

This section discusses the provisioning concepts most applicable to managing the *service*. This section is most relevant to personas involved in the [cloud setup step](about-iot-dps.md#cloud-setup-step) of getting a device ready for deployment.

### Service operations endpoint

This is the endpoint for managing the DPS service settings and maintaining the enrollment list. This endpoint is only used by the service administrator; it is not used by devices.

### Device provisioning endpoint

This is the central endpoint all devices talk to for provisioning. The URL is the same for all DPSes to eliminate the need to reflash devices with new connection information in supply chain scenarios. The [ID scope](#id-scope) ensures tenant isolation.

### Linked IoT hubs

DPS can only provision devices to IoT hubs which have been linked to it. Linking an IoT hub to DPS gives DPS read/write permissions to the IoT hub's device registry in order to create a device ID and set the initial configuration in the device twin.

[TODO: picture of how to link a hub]

### Allocation policy

The service-level setting that determines how DPS assigns devices to an IoT hub. There are three supported allocation policies:
* **Evenly weighted distribution**: linked IoT hubs are equally likely to have devices provisioned to them. The default setting. If you are provisioning devices to only one IoT hub, you can keep this setting.
* **Lowest latency**: devices are provisioned to an IoT hub based on the hub with the lowest latency to the device. If multiple linked IoT hubs would provide the same lowest latency, DPS hashes devices across those hubs
* **Static configuration via the enrollment list**: specification of the desired IoT hub in the enrollment list takes priority over the DPS-level allocation policy.

### Enrollment

An enrollment is the record of devices or groups of devices that may at some point register. The enrollment record contains the information about the device(s) as part of that enrollment including the attestation method for the device(s), and optionally initial desired configuration, desired IoT hub, and desired device ID. There are two types of enrollments supported by DPS.

#### Enrollment group

An enrollment group is a group of devices that share a specific attestation mechanism, such as all presenting x509 certificates which have been signed by the same root CA. Enrollment groups can only use the x509 attestation mechanism.

> [!TIP]
> We recommend using an enrollment group for a large number of devices which share a desired initial configuration, or for devices all going to the same tenant.

#### Individual enrollment

An individual enrollment is an entry for a single device that may register. Individual enrollments may use either x509 certificates or SAS tokens (in a real or virtual TPM) as attestation mechanisms. Individual enrollments may have the desired IoT hub device ID specified.

> [!TIP]
> We recommend using individual enrollments for devices which require unique initial configurations, or for devices which can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.

### Registration

A registration is the record of a device successfully registering/provisioning to an IoT Hub via DPS and are created automatically. Registration records can be deleted, but they cannot be updated.

### Operations

Operations are the billing unit of DPS. One operation is the successful completion of one instruction to the service. Operations include device registrations and re-registrations; operations also include service-side changes such as adding enrollment list entries, and updating enrollment list entries.
## Security concepts

### Attestation

See [attestation mechanism](#attestation-mechanism).

### Hardware security module

See [hardware security module](#hardware-security-module).

### Trusted Platform Module (TPM)

TPM can refer to a standard for securely storing keys used to authenticate the platform, or it can refer to the I/O interface used to interact with the modules implementing the standard. TPMs can exist as discrete hardware, integrated hardware, firmware-based, or software-based. Learn more about [TPMs and TPM attestation](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation). DPS only supports TPM 2.0.

## TODO: waiting for Eustace for the following, this header will be removed at a later date!!!
### Endorsement key

The endorsement key (EK) is an asymmetric key contained inside the TPM which was injected at manufacturing time. The EK is unique for every TPM and can identify it. The EK cannot be changed or removed.

### Storage root key

### Signing certificate

### Intermediate certificate

### Root certificate

### Leaf certificate
