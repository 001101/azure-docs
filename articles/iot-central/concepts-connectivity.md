---
title: Device connectivity in Azure IoT Central | Microsoft Docs
description: This article introduces key concepts relating to device connectivity in Azure IoT Central
author: dominicbetts
ms.author: dobett
ms.date: 11/30/2017
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: timlt
---
# Device connectivity in Azure IoT Central

This article introduces key concepts relating to device connectivity in Microsoft Azure IoT Central.

Azure IoT Central uses  [Azure IoT Hub Device Provisioning service (DPS)](https://docs.microsoft.com/en-us/azure/iot-dps/about-iot-dps),  enabling IoT Central to support onboarding & connecting of devices at scale.

-	With DPS there is one consistent way to connect devices to IoT Central 
-	IoT Central now supports device connection with industry recommended X509 cert based connectivity, while continuing to support and improve Shared Access Signatures (SAS) connectivity.
-	IoT Central customers can now generate credentials and configure them offline without having to first register the devices in IoT Central
-	IoT Central customers can now bring their own Device Ids to register devices in IoT Central, enabling simple integration with existing back office systems.

>[!NOTE]
>IoTCentral uses Azure IoT Device Provisioning service (DPS) underneath for all device registration and connection, [learn more about DPS](https://docs.microsoft.com/en-us/azure/iot-dps/about-iot-dps).

Based on your use case follow the instructions to connect devices to IoT Central
1. [Connect a single device quickly (using Shared Access Signatures)](#Connect-a-single-device)
1. [Connect devices at scale using Shared Access Signatures (SAS)](#Connect-devices-at-scale-using-Shared-Access-Signatures)
1. [Connect devices at scale using X509 certificates](#Connect-devices-using-X509-certificates) **recommended for production workloads**
1. [Connect devices without first registering devices](#Connect-devices-without-first-registering-devices) 

## Connect a single device
Connecting a single device to IoT Central using SAS is easy and takes only a few steps 
1. Add a **real device** from Device Explorer
1. Get connection the details such as **Scope ID, Device ID, Primary key** for the  added device from the device page.
    * **[Scope ID](https://docs.microsoft.com/en-us/azure/iot-dps/concepts-device#id-scope)** is per IoTCentral App and is generated by DPS, it is used to ensure unique device ID within this App.
    * **Device ID** is the unique device ID per App, the device needs to send this as part of the registration call.   
    * **Primary Key** is a SAS token, generated by IOTCentral for this specific device. 

    ![Connection details](media\concepts-connectivity\device-connect.PNG)


1. Use these connection details in your device code to provision and connect your device and start seeing the data flow through instantaneously 
For a step-by-step guide follow instructions on the [Add a Device page](tutorial-add-device.md).

## Connect devices at scale using Shared Access Signatures
To connect devices at scale with IoT Central using SAS, there are two steps involved 
1. **Register devices** by importing them into IoT Central via a CSV file and export devices with device connection details to use to connect your devices
1. **Device setup** The device is programmed with the provisioning service information, enabling it to call the provisioning service to get its connection info/IoT solution assignment when it is switched on.

>[!NOTE]
>An advanced option is also available where you can connect devices without having to first register devices in IoT Central, [learn more here](https://docs.microsoft.com/en-us/azure/iot-dps/about-iot-dps).

**Register devices**

To connect large number of devices to your application, Azure IoT Central offers bulk importing devices via a CSV file. 
CSV file requirements:
The CSV file should have the following columns (and headers)
1.  IOTC_DeviceID **(should be lowercase)**
1.  IOTC_DeviceName (Optional)

**Import devices** to register them in your application
1.  Choose **Explorer** on the left navigation menu.
1.  On the left panel, choose the device template for which you want to bulk create the devices. 
1.  Click **Import**, select the CSV file that has the list of Device IDs to be imported.
1.  Once the import completes, a success message is shown on the device grid.

**Export devices** to get the connection details, Export creates a CSV file with the Device Identity, Device Name, and the Device Key. Use these details to get connected to IoT Central.

 To bulk export devices from your application:
1.  Choose **Explorer** on the left navigation menu.
1.  Select the devices that you want to export and then click the **Export** action.
1.  Once the export completes, a success message is shown along with a link to download the generated file.
1.  Click on the success message to download the file to a local folder on the disk.
1.  The exported CSV file will have the following information: Device Identity, Device Name, and the Device Key

**Device set up**

1. Once you have the connection details, follow the instructions [to add device](tutorial-add-device.md). Once you have configured your device connect it to IoTCentral.

## Connect devices using X509 certificates

Using X.509 certificates as an attestation mechanism is an excellent way to scale **production** and simplify device provisioning. X.509 certificates are typically arranged in a certificate chain of trust in which each certificate in the chain is signed by the private key of the next higher certificate, and so on, terminating in a self-signed root certificate. This establishes a delegated chain of trust from the root certificate generated by a trusted root certificate authority (CA) down through each intermediate CA to the end-entity "leaf" certificate installed on a device. To learn more, see [Device Authentication using X.509 CA Certificates](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-x509ca-overview). 

To connect devices to IoT Central using X509 certificates, there are two key steps involved 
1. **Configure the connection settings** in IoT Central app by adding/verifying the X509 root/intermediate certificate used to generate the device certificates. Register devices by importing them into IoT Central via a CSV file. 

    ![Connection settings](media\concepts-connectivity\connection-settings.PNG)


1. **Device setup** : Generate the leaf certificates using the uploaded root certificate. Program the device with provisioning service information enabling it to get its connection details and IoT Central app assignment when switched on. 

**Configure Connection Settings** 
There are two steps to configure connection settings for X509 Certificates
1. Add X509 root or intermediate certificate used to generate the leaf device certificates.    
1. Certificate verification - Verifying certificate ownership ensures that the uploader of the certificate is in possession of the certificate's private key.
    Following are the steps to verify the certificate
[(learn more about certificate verification)](https://docs.microsoft.com/en-us/azure/iot-dps/how-to-verify-certificates).
    *  Generate Verification code
    *  Create an X.509 verification certificate with the verification code 
    *  Upload the signed verification certificate to verify this certificate        

**Device Setup** 
1. Generate the leaf-certificates for your devices using the root/intermediate certificate you have added to this app. Make sure you use the **Device ID** as a cname in the leaf certificates.
1. Use the **Scope ID, Device ID** and the generated **leaf certificate** to register the device.
1. Follow the [device setup instructions under DPS](https://docs.microsoft.com/en-us/azure/iot-dps/tutorial-set-up-device) for further details on setting up your device.

>[!NOTE]
>Use the **Device ID** as a cname when generating the leaf certificates for devices.
 
## Connect devices without first registering devices to IoT Central
One of the key scenarios IoTCentral enables is for OEMs to mass manufacture devices, generate credentials and configure them in the factory without having to come to IoT Central to register the devices. Once the devices are turned on and connect to 
IoTCentral the operator approves the device to connect to the IoT Central app.

Below are the steps to use this feature

1. **Configure the connection settings** in IoT Central app by adding/verifying the X509 root/intermediate certificate used to generate the device certificates.
1. **Device setup** 
    *   **Certificates X509** Generate the leaf certificates using the uploaded root/intermediate CA certificate.  
    *   **SAS** Device SAS keys can be generated outside of IoT Central using this [command line tool](https://github.com/Azure/dps-keygen) once you have the Device ID, and Group SAS key (from **Connection Settings**)

    Configure the device with provisioning service information enabling it to get its connection details when switched on.

1. **Approve/Associate devices** Once switched on the devices connect to DPS/IoTCentral for registration and show up under **UnAssociated Devices** in **Device Explorer**. The device provisioning status is **Registered**. The operator has to **Associate** the device to the appropriate device template and approve the device to connect to the IoT Central app.
1. The device then connects the provisioning status is changed to **Provisioned**, and starts sending data.

## Device Provisioning status
There are a series of steps involved when a real device is connected to Azure IoT Central 
1. **Registered** : The device is first **Registered**, meaning the device is created in IoT Central, and has the Device ID for the device.
This happens when  
    *   A new real device is added on **Explorer**
    *   A set of device is added using **Import** on **Explorer**
    *   A device that has not been registered but connects with valid credentials and is visible under **Un-Associated** devices. 

    In all of the above cases the provisioning status is **Registered**

1. **Provisioned** : The next step is when the device connects with valid credentials IoTCentral completes the provisioning step (by creating the device in IoT Hub). It then returns the connection string to the device to connect and start sending data. The device provisioning status now turns from **Registered** to **Provisioned**.

1.  **Blocked** : The operator can block a device, once a device is blocked it cannot send data to IoT Central and will have to be reset. Devices that are blocked have the provisioning status of **Blocked**. The operator can also unblock the device. Once unblocked the device provisioning status return to its previous provisioning status (Registered or Provisioned). 

## Getting device connection string
If you already have an IoT Central app and have devices connected, you can get still get device connection strings to Azure IoT Hub for temporary use, while you migrate your device code to use DPS SDK. 

Use the below instructions to get the device connection string.

 ```cmd/sh
git clone https://github.com/Azure/dps-keygen
cd dps-keygen
npm i -g
 ```
 **Usage**
In order to create a connection string, find your binary under bin/ folder
 ```cmd/sh
dps_cstr <scope_id> <device_id> <device_key>
 ```
You can get connection the details such as **Scope ID, Device ID, Device Primary key** from the device page.


## SDK support

The Azure Device SDKs offer the easiest way for you implement the code on your devices that connects to your Azure IoT Central application. The following device SDKs are available:

- [Azure IoT SDK for C](https://github.com/azure/azure-iot-sdk-c)
- [Azure IoT SDK for Python](https://github.com/azure/azure-iot-sdk-python)
- [Azure IoT SDK for Node.js](https://github.com/azure/azure-iot-sdk-node)
- [Azure IoT SDK for Java](https://github.com/azure/azure-iot-sdk-java)
- [Azure IoT SDK for .NET](https://github.com/azure/azure-iot-sdk-csharp)

Each device connects using a unique connection string that identifies the device. A device can only connect to the IoT hub where it is registered. When you create a real device in your Azure IoT Central application, the application generates a connection string for you to use.

## SDK features and IoT Hub connectivity

All device communication with IoT Hub uses the following IoT Hub connectivity options:

- [Device-to-cloud messaging](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c)
- [Device twins](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-device-twins)

The following table summarizes how Azure IoT Central device features map on to IoT Hub features:

| Azure IoT Central | Azure IoT Hub |
| ----------- | ------- |
| Measurement: Telemetry | Device-to-cloud messaging |
| Device properties | Device twin reported properties |
| Settings | Device twin desired and reported properties |

To learn more about using the Device SDKs, see one of the following articles for example code:

- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs.md)
- [Connect a Raspberry Pi device to your Azure IoT Central application](howto-connect-raspberry-pi-python.md)
- [Connect a DevDiv kit device to your Azure IoT Central application](howto-connect-devkit.md).

The following video presents an overview of how to connect a real device to Azure IoT Central:

>[!VIDEO https://channel9.msdn.com/Shows/Internet-of-Things-Show/Connect-real-devices-to-Microsoft-IoT-Central/Player]

## Protocols

The Device SDKs support the following network protocols for connecting to an IoT hub:

- MQTT
- AMQP
- HTTPS

For information about these difference protocols and guidance on choosing one, see [Choose a communication protocol](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-protocols).

If your device can't use any of the supported protocols, you can use Azure IoT Edge to do protocol conversion. IoT Edge supports other intelligence-on-the-edge scenarios to offload processing to the edge from the Azure IoT Central application.

## Security

All data exchanged between devices and your Azure IoT Central is encrypted. IoT Hub authenticates every request from a device that connects to any of the device-facing IoT Hub endpoints. To avoid exchanging credentials over the wire, a device uses signed tokens to authenticate. For more information, see, [Control access to IoT Hub](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-security).

> [!NOTE]
> Currently, devices that connect to Azure IoT Central must use SAS tokens. X.509 certificates are not supported for devices that connect to Azure IoT Central.

## Next steps

Now that you have learned about device connectivity in Azure IoT Central, here are the suggested next steps:

- [Prepare and connect a DevKit device](howto-connect-devkit.md)
- [Prepare and connect a Raspberry Pi](howto-connect-raspberry-pi-python.md)
- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs.md)
