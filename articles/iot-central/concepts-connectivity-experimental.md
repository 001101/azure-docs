---
title: Device connectivity in Azure IoT Central | Microsoft Docs
description: This article introduces key concepts relating to device connectivity in Azure IoT Central
author: dominicbetts
ms.author: dobett
ms.date: 11/30/2017
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: timlt
---
# Device connectivity in Azure IoT Central

This article introduces key concepts relating to device connectivity in Microsoft Azure IoT Central.

Azure IoT Central uses [Azure IoT Hub Device Provisioning Service](https://docs.microsoft.com/azure/iot-dps/about-iot-dps) to support registering and connecting devices at scale.

- Customers can now generate device credentials and configure the devices  offline without having to first register the devices in IoT Central.
- IoT Central supports device connection with industry recommended X.509 certificate-based connectivity, while continuing to support and improve shared access signatures connectivity.
- IoT Central customers can now use their own device IDs to register devices in IoT Central, enabling simple integration with existing back-office systems.
- There is one consistent way to connect devices to IoT Central.

>[!NOTE]
>IoT Central uses IoT Hub Device Provisioning Service for all device registration and connection. [Learn more](https://docs.microsoft.com/azure/iot-dps/about-iot-dps)

Based on your use case, follow the appropriate instructions to connect devices to IoT Central:

- [Connect a single device quickly (by using shared access signatures)](#connect-a-single-device)
- [Connect devices at scale by using shared access signatures](#connect-devices-at-scale-using-shared-access-signatures)
- [Connect devices at scale by using X.509 certificates](#connect-devices-using-x509-certificates) (**recommended for production workloads**)
- [Connect without first registering devices](#connect-without-first-registering-devices) 

>[!NOTE]
>The global end point for devices to connect and provision is **global.azure-devices-provisioning.net**.

## Connect a single device

Connecting a single device to IoT Central by using shared access signatures takes only a few steps:

1. Add a **real device** from device explorer. Select **+New** > **Real** to add a real device.
    * Enter the **Device ID** **<span style="color:Red">(should be lowercase)</span>** or use the suggested device ID.
    * Enter the **Device Name** or use the suggested name.
    ![Add Device](media/concepts-connectivity/add-device.png)
1. Get the connection details, like the **Scope ID**, **Device ID**, and **Primary Key**, for the added device by selecting **Connect** on the device page.
    * **[Scope ID](https://docs.microsoft.com/azure/iot-dps/concepts-device#id-scope)** is per IoT Central app and is generated by Device Provisioning Service. This ID is used to ensure a unique device ID within an app.
    * **Device ID** is the unique device ID per app. The device needs to send the device ID as part of the registration call.
    * **Primary Key** is a shared access signatures token, generated by IoT Central for this specific device. 
    ![Connection details](media/concepts-connectivity/device-connect.png)
1. Use these connection details **Device Identity**, **Device Name**, and the device's **Primary Key** in your device code to provision and connect your device and start seeing the data flow through instantaneously. If you are using the MxChip device, follow [the step-by-step instructions here](howto-connect-devkit-experimental.md#add-a-real-device), starting from the section **Prepare the DevKit device**.

    Below are the references for other languages you might want to use.

    *   **C language:** If you are using C, follow [this C sample device client](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md) to connect a sample device. Use the following settings in the sample.   

         ```c
         hsm_type = SECURE_DEVICE_TYPE_SYMMETRIC_KEY;

         ## Enter the Device Id and Symmetric keys 
         prov_dev_set_symmetric_key_info("<Device Id>", "<Enter Primary Symmetric key here>");
        ```

    *   **Node.js:**  If you are using Node.js, follow [the step-by-step instructions here](tutorial-add-device-experimental.md#prepare-the-client-code), starting from the section **Prepare the client code**.

## Connect devices at scale by using shared access signatures

To connect devices at scale with IoT Central by using shared access signatures, there are two overall steps:

1. **Device registration:** Register the devices by importing them into IoT Central via a CSV file and then using the **Export** action to export your devices and get their device connection details.
1. **Device setup:** Program the devices with the connection details (**Scope ID**, **Device ID**, and **Primary Key**). When each device is switched on, it will call the provisioning service to get its connection information or IoT Central app assignment.

>[!NOTE]
>An advanced option is also available where you can connect devices without having to first register the devices in IoT Central. [Learn more](https://docs.microsoft.com/azure/iot-dps/about-iot-dps).

### Device registration

To connect large number of devices to your application, IoT Central supports bulk importing of devices via a CSV file. 

1. Import devices to register them in your application:

   1.  Choose **Explorer** on the left navigation menu.
   1.  On the left panel, choose the device template for which you want to bulk create the devices. 
   1.  Select **Import**, and then select the CSV file that has the list of Device IDs to be imported.
The CSV file should have the following columns (and headers)
       *   IOTC_DeviceID **<span style="color:Red">(should be lowercase)</span>**
       *   IOTC_DeviceName (optional)
   1.  After the import is finished, a success message is shown on the device grid.

1. Export devices to get their connection details:

   The **Export** action creates a CSV file with the device ID, device name, and the device keys. Use these details to connect the device to IoT Central. To bulk export devices from your application:

   1.  Choose **Explorer** on the left navigation menu.
   1.  Select the devices that you want to export, and then select the **Export** action.
   1.  After the export is finished, a success message is shown along with a link to download the generated file.
   1.  Select the success message to download the file to a local folder on the disk.
   1.  The exported CSV file will have the following columns that contain the connection details (**Device ID**, **Device Name**, **Device Primary/Secondary Keys**, and **Primary/Secondary certificate thumbprints**):
   
       *   IOTC_DEVICEID
       *   IOTC_DEVICENAME
       *   IOTC_SASKEY_PRIMARY
       *   IOTC_SASKEY_SECONDARY
       *   IOTC_X509THUMBPRINT_PRIMARY	
       *   IOTC_X509THUMBPRINT_SECONDARY

### Device setup

 To provision and connect your device, use the connection details **Device Identity (IOTC_DEVICEID)**, **Device Primary Key (IOTC_SASKEY_PRIMARY)**, and **Scope ID** in your device code. If you have not already done so, get the **Scope ID** from your IoT Central app by selecting **Administration** > **Device Connection** > **Scope ID**.

If you are connecting a MxChip IoT DevKit device, follow [the step-by-step instructions here](howto-connect-devkit-experimental.md#add-a-real-device), starting from the section **Prepare the DevKit device**.

Below are the references for other languages you might want to use.

   *   **C language:** If you are using C, follow [this C sample device client](https://github.com/Azure/azure-iot-sdk-c/blob/master/provisioning_client/devdoc/using_provisioning_client.md) to connect a sample device. Use the following settings in the sample:
   
         ```c
         hsm_type = SECURE_DEVICE_TYPE_SYMMETRIC_KEY;

         ## Enter the Device Id and Symmetric keys 
         prov_dev_set_symmetric_key_info("<Device Id>", "<Enter Primary Symmetric key here>");
        ```

    * **Node.js:** If you are using Node.js, follow [the step-by-step instructions here](tutorial-add-device-experimental.md#prepare-the-client-code), starting from the section **Prepare the client code**.

## Connect devices by using X.509 certificates

Using X.509 certificates as an attestation mechanism is an excellent way to scale production and simplify device provisioning. X.509 certificates are typically arranged in a certificate chain of trust, in which each certificate in the chain is signed by the private key of the next higher certificate, and so on, terminating in a self-signed root certificate. This structure establishes a delegated chain of trust from the root certificate generated by a trusted root certificate authority (CA) down through each intermediate CA to the end-entity "leaf" certificate that's installed on a device. To learn more, see [Device authentication by using X.509 CA certificates](https://docs.microsoft.com/azure/iot-hub/iot-hub-x509ca-overview). 

To connect devices to IoT Central by using X.509 certificates, there are three key steps involved:
 
1. **Configure the connection settings** in the IoT Central app by adding or verifying the X.509 root or intermediate certificate used to generate the device certificates. There are three steps to configure the connection settings for X.509 certificates:  

    *   **Add the X.509 root or intermediate certificate** you are using to generate the leaf device certificates. Go to **Administration** > **Device Connection** > **Certificates**. 
    
        ![Connection settings](media/concepts-connectivity/connection-settings.png)

    *   **Verify the certificate.** Verifying certificate ownership ensures that the uploader of the certificate possesses the certificate's private key. To verify the certificate:

        *  Generate the verification code. Select the button next to the **Verification Code** field to generate this code. 
        *  Create an X.509 verification certificate with the verification code. Save the certificate as a .cer file. 
        *  Upload the signed verification certificate, and select **Verify**.

        ![Connection settings](media/concepts-connectivity/verify-cert.png)

    *   **Add a secondary certificate.** During the lifecycle of your IoT solution, you'll need to roll certificates. Two of the main reasons for rolling certificates are security breaches and certificate expirations. Secondary certificates are used to reduce downtime for devices attempting to provision while you are updating the primary certificate.

    **FOR TESTING PURPOSES ONLY** 
    
    Below are some utility command-line tools you can use to generate CA certificates and device certificates.

    * If you are using a MxChip IoT DevKit device, here is a [command-line tool](https://aka.ms/iotcentral-docs-dicetool) to generate CA certificates. Add it to your IoT Central app and verify the certificates. 

    *   Use this [command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to:

        * Create the certificate chain (follow step 2 in the GitHub docs). 
         Save the certificates as .cer files and upload them to IoT Central (as primary certificates).   
        * Get the verification code from the IoT Central app, generate the certificate (follow step 3 in the GitHub docs), and upload the certificate to verify it. 
        * Create leaf certificates with your device ID as a parameter to the tool (follow step 4). Save the certificate and use it on your device.

1. **Register devices** by importing them into IoT Central via a CSV file.

1. **Device setup**: Generate the leaf certificates by using the uploaded root certificate. Make sure you use the **Device ID** as the CNAME in the leaf certificates and make sure it is in **lowercase**. Here is a [command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to generate leaf/device certificates for **TESTING PURPOSES ONLY**.

1. **Program the device with provisioning service information**, enabling it to get its connection details and its IoT Central app assignment when it's switched on.    

    **Further references**

    *   [Sample implementation for Raspberry Pi](https://aka.ms/iotcentral-docs-Raspi-releases)  

    *   [Sample device client in C](https://github.com/Azure/azure-iot-sdk-c/blob/dps_symm_key/provisioning_client/devdoc/using_provisioning_client.md)

>[!NOTE]
>Use the **Device ID** as a CNAME when you're generating the leaf certificates for devices.

>[!NOTE]
>The **Device ID** should be lowercase. 
 
## Connect without first registering devices

One of the key scenarios IoT Central enables is for OEMs to mass-manufacture devices, generate credentials, and configure the devices in the factory without having to first register the devices in IoT Central. After the devices are turned on and they attempt to connect to IoT Central, the operator approves the devices to connect to the IoT Central app.

Below is the flow to connect devices with this feature:

![Connection settings](media/concepts-connectivity/device-connection-flow.png)

Follow the steps based on your choice of device-authentication scheme (X.509 certificates or shared access signatures):

1. **Configure or get the connection settings:**

    * **X.509 certificates:** [Add and verify the root or intermediate certificate](#connect-devices-using-x509-certificates) and use it to generate the device certificates in the next step.
    * **Shared access signatures:** Copy the primary key (this key is the group shared access signatures key for this IoT Central application) and use it to generate the device shared access signatures keys in the next step.

       ![Connection settings for shared access signatures](media/concepts-connectivity/connection-settings-sas.png)

1. **Generate the device credentials:**

    *   **X.509 certificates:** Generate the leaf-certificates for your devices using the root or intermediate certificate you have added to this app. Make sure you use the **Device ID** as a CNAME in the leaf certificates and **<span style="color:Red">make sure it is lowercase</span>**. Here is a [command-line tool](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md ) to generate leaf/device certificates for testing.
    *   **Shared access signatures:** Device shared access signatures keys can be generated using this [command-line tool](https://www.npmjs.com/package/dps-keygen). Use the primary shared access signatures key (group shared access signatures key) from the previous step. **<span style="color:Red">Make sure the Device ID is in lowercase</span>**.

        Use the below instructions to generate a device shared access signatures key:           

        ```
        npm i -g dps-keygen
        ```
    
        **Usage**
                        
        ```
        dps-keygen <Primary_Key(GroupSAS)> <device_id>
        ```

1. **Setup the devices:** Flash the device with the **Scope ID**, **Device ID**, and **Device certificate/SAS key**, and then turn on the device to connect it to the IoT Central app.

1. **Connect the devices to IoT Central:** After the devices are switched on, they connect to Device Provisioning Service/IoT Central for registration.

1. **Associate the devices to a template:** The connected devices will show up under **Un-Associated devices** in device explorer. Their device provisioning status is **Registered**. **Associate** the devices to the appropriate device template and approve the devices to connect to the IoT Central app. The devices get the connection details for the IoT Central app, and then they connect and start sending data. Device provisioning is now complete and the **Provisioning status** for the devices turns to **Provisioned**.

## Device provisioning status

There are a series of steps involved when a real device is connected to IoT Central:

1. **Registered**: The device is first registered, meaning the device is created in IoT Central, and it has the Device ID for the device. A device is registered when:

    * A new real device is added in **Explorer**
    * A set of devices is added by using **Import** in **Explorer**
    * A device that has not been registered connects with valid credentials and is visible under **Un-Associated devices**

    In all of the above cases, the **Provisioning status** is **Registered**.

1. **Provisioned**: When the device connects with valid credentials, IoT Central completes the provisioning step (by creating the device in IoT Hub). IoT Central then returns the connection string to the device so it can connect and start sending data. The device's **Provisioning status** turns from **Registered** to **Provisioned**.

1. **Blocked**: The operator can block a device. After a device is blocked, it can't send data to IoT Central and will have to be reset. Devices that are blocked have the **Provisioning status** of **Blocked**. The operator can also unblock the device. After it's unblocked, the device's **Provisioning status** returns to its previous status (**Registered** or **Provisioned**). 

## Getting the device connection string

You can get the Iot Hub device connection string to Azure IoT Hub by using the following steps:

1. Get the device's connection details, like the **Scope ID**, **Device ID**, and **Primary Key** from the **Device Connection** page (go to the **Device** page and select **Connect**). 

    ![Connection details](media/concepts-connectivity/device-connect.png)

1. Get the device's connection string by using the command-line tool below.
    Use the following command to get the device's connection string:  

    ```cmd/sh
    npm i -g dps-keygen
    ```

    **Usage**

    To create a connection string, find the binary under the `bin/` folder:

    ```cmd/sh
    dps_cstr <scope_id> <device_id> <Primary Key(for device)>
    ```

    Learn more about the [dps-keygen tool here](https://www.npmjs.com/package/dps-keygen).

## SDK support

The Azure Device SDKs offer the easiest way for you to use the code on your devices that connect to your IoT Central application. The following device SDKs are available:

- [Azure IoT SDK for C](https://github.com/azure/azure-iot-sdk-c)
- [Azure IoT SDK for Python](https://github.com/azure/azure-iot-sdk-python)
- [Azure IoT SDK for Node.js](https://github.com/azure/azure-iot-sdk-node)
- [Azure IoT SDK for Java](https://github.com/azure/azure-iot-sdk-java)
- [Azure IoT SDK for .NET](https://github.com/azure/azure-iot-sdk-csharp)

Each device connects by using a unique connection string that identifies the device. A device can connect only to the IoT hub where it is registered. When you create a real device in your Azure IoT Central application, the application generates a connection string for you to use.

## SDK features and IoT Hub connectivity

All device communication with IoT Hub uses the following IoT Hub connectivity options:

- [Device-to-cloud messaging](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c)
- [Device twins](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-device-twins)

The following table summarizes how IoT Central device features map to IoT Hub features:

| Azure IoT Central | Azure IoT Hub |
| ----------- | ------- |
| Measurement: Telemetry | Device-to-cloud messaging |
| Device properties | Device twin reported properties |
| Settings | Device twin desired and reported properties |

To learn more about using the Device SDKs, see the following articles for sample code:

- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs-experimental.md)
- [Connect a Raspberry Pi device to your Azure IoT Central application](howto-connect-raspberry-pi-python.md)
- [Connect a DevDiv kit device to your Azure IoT Central application](howto-connect-devkit-experimental.md)


## Protocols

The Device SDKs support the following network protocols for connecting to an IoT hub:

- MQTT
- AMQP
- HTTPS

For information about these protocols and guidance on choosing one, see [Choose a communication protocol](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-protocols).

If your device can't use any of the supported protocols, you can use Azure IoT Edge to do protocol conversion. IoT Edge supports other intelligence-on-the-edge scenarios to offload processing to the edge from the IoT Central application.

## Security

All data exchanged between devices and your IoT Central app is encrypted. IoT Hub authenticates every request from a device that connects to any of the device-facing IoT Hub endpoints. To avoid exchanging credentials over the wire, a device uses signed tokens to authenticate. For more information, see [Control access to IoT Hub](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-security).

> [!NOTE]
> Currently, devices that connect to IoT Central must use shared access signatures tokens. X.509 certificates are not supported for devices that connect to IoT Central.

## Next steps

- [Prepare and connect a DevKit device](howto-connect-devkit-experimental.md)
- [Prepare and connect a Raspberry Pi device](howto-connect-raspberry-pi-python.md)
- [Connect a generic Node.js client to your Azure IoT Central application](howto-connect-nodejs-experimental.md)
