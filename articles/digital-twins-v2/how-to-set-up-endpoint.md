---
# Mandatory fields.
title: Create an Azure Digital Twins instance
titleSuffix: Azure Digital Twins
description: See how to set up an instance of the Azure Digital Twins service.
author: cschormann
ms.author: cschorm # Microsoft employees only
ms.date: 3/17/2020
ms.topic: how-to
ms.service: digital-twins

# Optional fields. Don't forget to remove # if you need a field.
# ms.custom: can-be-multiple-comma-separated
# ms.reviewer: MSFT-alias-of-reviewer
# manager: MSFT-alias-of-manager-or-PM-counterpart
---

# Connect an Endpoint to Azure Digital Twins

In Azure Digital Twins, you use **endpoints** to route data to downstream services or to connect to compute. You then define a **route** to specify which events generated by ADT are delivered to which endpoint.

Supported endpoint types include:
* Event Grids
* Event Hub
* Service Bus

See [Choose between Azure messaging services](https://docs.microsoft.com/en-us/azure/event-grid/compare-messaging-services) for more information on the different endpoints.

## Linking an Endpoint to ADT

To link an endpoint to ADT, the respective Event Hub, Event Grid topic or Service Bus already must exist. 

For the purpose of this example, let's create an Event Grid topic using  Azure cli:

```bash
az eventgrid topic create -g <your-resource-group-name> --name <your-topic-name> -l "westcentralus"
```

Once you have created the topic, you can link it to Azure Digital Twins as follows:

```bash
az dt endpoints add eventgrid --endpoint-name <endpoint-name> --eventgrid-resource-group <eg-resource-group-name> --eventgrid-topic <your-topic-name> -n <your-adt-instance-name>
```

This makes the desired topic available inside of Azure Digital Twins under the name specified with the --endpoint-name argument. You will typically use that name as the target of a **route** created using the Azure Digital Twins service API.

Equivalent commands exist for Event Hub and Service Bus endpoints:
* Add ServiceBus Topic endpoint (requires a pre-created ServiceBus resource)
```bash 
az dt endpoints add servicebus --endpoint-name mysb_endpoint --servicebus-resource-group mysb_resourcegroup --servicebus-namespace mysb_namespace --servicebus-topic mysb_topic --servicebus-policy mysb_topicpolicy -n mydtinstance
```
* Add EventHub endpoint (requires pre-created EventHub resource)
```bash
az dt endpoints add eventhub --endpoint-name myeh_endpoint --eventhub-resource-group myeh_resourcegroup --eventhub-namespace myeh_namespace --eventhub myeventhub --eventhub-policy myeh_policy -n mydtinstance
```

## Creating a Route
To actually send data from Azure Digital Twins to an endpoint, you need to define a route. This is done using the service APIs for Azure Digital Twins. 

The following code sample shows how to create, list and delete and event route:
```csharp
try
{
    Log("Create a route: testRoute1");
    EventRoute er = new EventRoute(<your-endpoint-name>);
    await client.EventRoutes.AddAsync(<your-route-name>, er);
    Log("Create route succeeded. Now listing routes:");
    List<EventRoute> routes = await ListRoutes();
    Log("Deleting routes:");
    foreach (EventRoute r in routes)
    {
        Log($"Deleting route {r.Id}:");
        await client.EventRoutes.DeleteAsync(r.Id);
        Log("Delete route succeeded."); 
    }
}
catch (ErrorResponseException e)
{
    Console.WriteLine($"*** Error in event route creation ({e.Request.RequestUri}):\n${e.Response.StatusCode}\n${e.Response.ReasonPhrase}");
}
```

The ListRoutes routine used by the code above looks like this:
```csharp
static async Task<List<EventRoute>> ListRoutes()
{
    List<EventRoute> evList = new List<EventRoute>();
    // Find the relationships for the twin
    try
    {
        
        // Enumerate the IPage object returned to get the results
        // ListAsync will throw if an error occurs
        IPage<EventRoute> evPage = await client.EventRoutes.ListAsync();
        evList.AddRange(evPage);
        // If there are more pages, the NextPageLink in the page is set
        while (evPage.NextPageLink != null)
        {
            // Get more pages...
            evPage = await client.EventRoutes.ListNextAsync(evPage.NextPageLink);
            evList.AddRange(evPage);
        }
        Console.WriteLine($"Found {evList.Count} event routes");
        // Let's delete the edges we found
        foreach (EventRoute r in evList)
        {
            Log($"Found route {r.Id} to {r.EndpointId}");
        }
    }
    catch (ErrorResponseException e)
    {
        Log($"*** Error retrieving event routes: {e.Response.StatusCode}", ConsoleColor.Red);
    }
    return evList;
}
``` 

In the future, route definitions will let you specify a filter to selectively send data to specific endpoints. 

In the mean time, we recommend using an EventGrid endpoint and using EventGrid filters to selectively send data to downstream services or process it with compute.

Without filtering, endpoints receive a variety of events from Azure Digital Twins:
* Telemetry fired on twins using the Azure Digital Twins service API
* Twin property change notifications (fired on property changes on any twin in the Azure Digital Twins instance)
* Lifecycle events, fired when twins or relationships are created or deleted
* Model change events, sent when types configured in an Azure Digital Twins instance are added or deleted