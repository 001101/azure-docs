---
title: Batch process messages and outputs - Azure Logic Apps | Microsoft Docs
description: Group, send, and receive messages and outputs in batches for logic apps
keywords: batch, batch processing
author: jonfancey
manager: anneta
editor: ''
services: logic-apps
documentationcenter: ''

ms.assetid: 
ms.service: logic-apps
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/7/2017
ms.author: LADocs; estfan; jonfan
---

# Batch processing: Group, send, and receive messages or output in batches for logic apps

To reduce the number of messages between logic apps, 
you can group messages and outputs from actions 
so that logic apps can process these items in batches. 
You can create logic apps that receive items as a batch 
by using the **Batch** trigger. You can also create logic apps 
that send items to a batch by using the **Batch** action.

This topic shows how you can build a batching solution by performing these tasks: 

* Create a logic app that can receive data sent to a batch.
* Create a logic app that sends data to a batch.
* Set up a partition for a batch so you can create batches 
based on a unique key, for example, a customer number. 

## Requirements

To create and run logic apps, you need these items:

* An Azure subscription. If you don't have a subscription, you can 
[start with a free Azure account](https://azure.microsoft.com/free/). 
Otherwise, you can [sign up for a Pay-As-You-Go subscription](https://azure.microsoft.com/pricing/purchase-options/).

* Basic knowledge about 
[how to create logic apps](../logic-apps/logic-apps-create-a-logic-app.md) 

* An email account with any 
[email provider supported by Azure Logic Apps](../connectors/apis-list.md)

## Create logic apps that receives data as a batch

Before you can send items to a batch, you must first create a "batch receiver" 
logic app by using the **Batch** trigger. In the batch receiver logic app, 
you define the batch name, release criteria, and other settings. That way, 
when you later create logic apps that send data to a batch, 
you can select this "batch receiver" logic app. Also, 
sender logic apps need to know the batch where they can send data. 
The receiver logic apps don't need to know anything about the senders.

1. In the [Azure portal](https://portal.azure.com), 
create a logic app with this name: "BatchReceiver" 

2. In Logic Apps Designer, add the **Batch** trigger, 
which starts your logic app workflow. 
In the search box, enter "batch" as your filter. 
Select this trigger: **Batch – Batch messages**

   ![Add Batch trigger](./media/logic-apps-send-receive-batch-outputs-messages/add-batch-receiver-trigger.png)

3. Provide a name for the batch, 
and specify criteria for releasing the batch, for example:

   * **Batch Name**: "TestBatch"
   * **Message Count**: "5"

   ![Provide Batch trigger details](./media/logic-apps-send-receive-batch-outputs-messages/receive-batch-trigger-details.png)

4. Add another action that sends an email when the batch trigger fires. 
So, each time the batch has five items, the logic app sends an email.

   1. Under the batch trigger, choose **+ New Step** > **Add an action**.

   2. In the search box, enter "email" as your filter.

   3. Based on your email provider, select an email connector. 
   
      For example, if you have a work or school account, 
      select the Office 365 Outlook connector. 
      If you have a Gmail account, select the Gmail connector.

   4. Select this action for your connector: **{*email provider*} - Send an email**

      ![Select "Send an email" action for your email provider](./media/logic-apps-send-receive-batch-outputs-messages/add-send-email-action.png)

5. If you didn't already set up a connection for your email provider, 
provide your email credentials for authentication when prompted. 
Learn more about [authenticating your email credentials](../logic-apps/logic-apps-create-a-logic-app.md).

6. Set the properties for the action you just added.

   1. For the **To** box, enter the recipient's email address. 
   For testing purposes, you can use your own email address.

   2. In the **Subject** box, select **Partition Name** when 
   the **Dynamic content** list appears.

      ![From the "Dynamic content" list, select "Partition Name"](./media/logic-apps-send-receive-batch-outputs-messages/send-email-action-details.png)

      In a later section, you specify how to partition, or divide, 
      the target batch into logical sets where you send messages. 
      Each set has a unique number that's generated by the sender logic app. 
      This capability lets you use a single batch with multiple subsets and 
      define each subset with the name that you provide.

   3. For the **Body** box, select **Message Id**.

      > [!NOTE]
      > Because the input for the send email action is an array, 
      > the designer automatically adds a **For each** loop 
      > around the **Send an email** action. 
      > This loop performs the inner action on each item in the batch. 
      > With the batch trigger set to five items, you get five emails 
      > each time the trigger fires.

      ![For "Body", select "Message Id"](./media/logic-apps-send-receive-batch-outputs-messages/send-email-action-details-for-each.png)

7.  Now that you created a logic app that can receive messages as a batch, 
save your logic app.

    ![Save your logic app](./media/logic-apps-send-receive-batch-outputs-messages/save-batch-receiver-logic-app.png)

## Create logic apps that send data to a batch

Now create one or more logic apps that send data to the batch. 
Sender logic apps need to know they send the data, 
but receiver logic apps don't need to know anything about the senders.

1. Create another logic app with this name: "BatchSender"

   1. In the search box, enter "recurrence" as your filter. 
   Select this trigger: **Schedule - Recurrence**

      ![Add the "Schedule-Recurrence" trigger](./media/logic-apps-send-receive-batch-outputs-messages/add-schedule-trigger-batch-receiver.png)

   2. Set the frequency and interval to run the sender logic app every minute.

      ![Set frequency and interval for recurrence trigger](./media/logic-apps-send-receive-batch-outputs-messages/recurrence-trigger-batch-receiver-details.png)

2. Add a new step for sending messages to a batch.

   1. Under the recurrence trigger, choose **+ New Step** > **Add an action**.

   2. In the search box, enter "batch" as your filter. 

   3. Select this action: 
   **Send messages to batch – Choose a Logic Apps workflow with batch trigger**

      ![Select "Send messages to batch"](./media/logic-apps-send-receive-batch-outputs-messages/send-messages-batch-action.png)

   4. Now select your "BatchReceiver" logic app that you previously created, 
   which now appears as an action.

      ![Select "batch receiver" logic app](./media/logic-apps-send-receive-batch-outputs-messages/send-batch-select-batch-receiver.png)

      > [!NOTE]
      > The list also shows any other logic apps that have batch triggers.

3. Set the batch properties.

   1. For **Batch Name**: "TestBatch"

      > [!IMPORTANT]
      > Make sure that you don't change the batch name, 
      > which must match the batch name defined by the receiver logic app.
      > Changing the batch name causes the sender logic app to fail.

   2. In the **Message Content** box, 
   when the dynamic content list appears, choose **Expression**.
   Enter the expression **utcnow()**, and choose **OK**. 

      This expression sets the current date and time for the 
      message content that you send to the batch.

      ![In "Message Content", choose "Expression". Enter "utcnow()".](./media/logic-apps-send-receive-batch-outputs-messages/send-batch-receiver-details.png)

4. Now set up a partition for the batch. Choose **Show advanced options**.

   1. In the **Partition Name** box, 
   when the dynamic content list appears, choose **Expression**.

   2. Enter this expression: **rand(1,6)**

      > [!NOTE] 
      > This **rand** function expression generates a number between one and five. 
      > So you are dividing this batch into five numbered partitions, 
      > which this expression dynamically sets.

      ![Set up partition for your destination batch](./media/logic-apps-send-receive-batch-outputs-messages/send-batch-receiver-partition-advanced-options.png)

5. Save your logic app. Your sender logic app looks like this example:

   ![Save your sender logic app](./media/logic-apps-send-receive-batch-outputs-messages/send-batch-receiver-details-finished.png)

## Test your logic app batching solution

To test your batching solution, 
leave your logic apps running for a few minutes. 
Soon, you start getting emails in groups of five, 
all with the same partition key.

Your BatchSender logic app runs every minute, 
generates a random number between one and five, 
and uses this generated number as the partition key 
for the target batch where messages are sent. 
Each time the batch has five items with the same partition key, 
your BatchReceiver logic app fires and sends mail for each message.

> [!IMPORTANT]
> When you're done testing, make sure that you disable the 
> BatchSender logic app to stop sending messages 
> to the batch and overloading your inbox.

## Next steps

* [Build on logic app definitions by using JSON](../logic-apps/logic-apps-author-definitions.md)
* [Build a serverless app in Visual Studio with Azure Logic Apps and Functions](../logic-apps/logic-apps-serverless-get-started-vs.md)
* [Exception handling and error logging for logic apps](../logic-apps/logic-apps-scenario-error-and-exception-handling.md)
