---
# Mandatory fields. See more on aka.ms/skyeye/meta.
title: Content Key Policies in Media Services - Azure | Microsoft Docs
description: This article gives an explanation of what Content Key Policies are, and how they are used by Azure Media Services.
services: media-services
documentationcenter: ''
author: Juliako
manager: femila
editor: ''

ms.service: media-services
ms.workload: 
ms.topic: article
ms.date: 05/15/2019
ms.author: juliako
ms.custom: seodec18

---

# Content Key Policies

With Media Services, you can deliver your live and on-demand content encrypted dynamically with Advanced Encryption Standard (AES-128) or any of the three major digital rights management (DRM) systems: Microsoft PlayReady, Google Widevine, and Apple FairPlay. Media Services also provides a service for delivering AES keys and DRM (PlayReady, Widevine, and FairPlay) licenses to authorized clients.

To specify encryption options on your stream, you need to create a [Content Key Policy](https://docs.microsoft.com/rest/api/media/contentkeypolicies) and associate it with your [Streaming Locator](streaming-locators-concept.md). The **Content Key Policy** configures how the content key is delivered to end clients via the Key Delivery component of Media Services. You can let Media Services to autogenerate the content key. Typically, you would use a long lived key and check for the policies existence with **Get**. To get the key, you need to call a separate action method to get secrets or credentials. The [Get a signing key from the existing policy](get-content-key-policy-dotnet-howto.md) example shows how to use **GetPolicyPropertiesWithSecretsAsync** to get to the key.

> [!IMPORTANT]
> * Properties of **Content Key Policies** that are of the Datetime type are always in UTC format.
> * You should design a limited set of policies for your Media Service account and re-use them for your Streaming Locators whenever the same options are needed. 

## Updating Content Key Policies

**Content Key Policies** are updatable. For example, you might want to update the policy if you need to do a key rotation. You can update the primary verification key and the list of alternate verification keys in the existing policy. It can take up to 15 minutes for the Key Delivery caches to update and pick up the updated policy. 

## User specified Content Key

When creating Streaming Locator, you may want to specify you own Content Key ID and value instead of using an autogenerated by Media Services Content Key. 

Some reasons you might not want to autogenerate the Content Key:  

* You want to implement a high availability service. For example, you might already have services set up in one data center and need to use same Content Keys in another data center so CDN cache can be shared.   
* To use a custom key delivery service to deliver Content Keys. You might need to do that if your Content Keys have already been generated before adopting Azure Media Service.  

To use your own Content Key ID and value, you need to set a label on the Content Key in the Streaming Policy (all predefined Streaming Policies which use Content Keys already have labels assigned). Then, you can specify the Content Key ID and value setting the label on the `LabelReferenceInStreamingPolicy` property (when creating Streaming Locators).  

The following .NET snippet shows how to set a user specified Content Key on the Streaming Locator:

```csharp
var streamingLocatorWithUserDefinedContentKeySupport = new StreamingLocator() 
{ 
    AssetName = "asset", 
    StreamingPolicyName = PredefinedStreamingPolicy.ClearStreamingOnly, 
    DefaultContentKeyPolicyName = "content key policy", 
    ContentKeys = new List<StreamingLocatorContentKey>() 
    { 
        new StreamingLocatorContentKey() 
        { 
            LabelReferenceInStreamingPolicy = "clearKeyDefault", 
            Id = Guid.Parse("2A0A9D5F-F9BF-48B3-B13B-283C4C2E47BA"), 
            Value = "2UqLohAfWsEGkULYxHjYZg==" 
        } 
    } 
}; 
 ```

## Different content keys for different tracks

You may want to use one Content Key for HD tracks and a different Content Key for other tracks. Currently, Media Services supports multiple Content Keys for `CommonEncryptionCenc` (as shown below). `TrackPropertyType.FourCC` can be used to specify different tracks. Each encryption scheme must specify a default key which is used as a fall back key if a track is not falling into any specified tracks in `KeyToTrackMappings`. 

The following .NET snippet shows how to specify different content keys for different tracks:

```csharp
var streamingPolicyWithMutlipleContentKeySupport = new StreamingPolicy 
{ 
    CommonEncryptionCenc = new CommonEncryptionCenc() 
    { 
        ContentKeys = new StreamingPolicyContentKeys() 
        { 
            DefaultKey = new DefaultKey() { Label = "cencKeyDefault" }, 
            KeyToTrackMappings = new List<StreamingPolicyContentKey>() 
            { 
                new StreamingPolicyContentKey() 
                { 
                    Label = "cencKeyForHev1", 
                    Tracks = new List<TrackSelection>() 
                    { 
                        new TrackSelection() 
                        { 
                            TrackSelections = new List<TrackPropertyCondition> 
                            { 
                                new TrackPropertyCondition() 
                                { 
                                    Property = TrackPropertyType.FourCC, 
                                    Operation = TrackPropertyCompareOperation.Equal, 
                                    Value = "hev1" 
                                } 
                            } 
                        } 
                    } 
                }, 
                new StreamingPolicyContentKey() 
                { 
                    Label = "cencKeyForMp4a", 
                    Tracks = new List<TrackSelection>() 
                    { 
                        new TrackSelection() 
                        { 
                            TrackSelections = new List<TrackPropertyCondition> 
                            { 
                                new TrackPropertyCondition() 
                                { 
                                    Property = TrackPropertyType.FourCC, 
                                    Operation = TrackPropertyCompareOperation.Equal, 
                                    Value = "mp4a" 
                                } 
                            } 
                        } 
                    } 
                } 
            } 
        } 
    } 
}; 
```

## Filtering, ordering, paging

See [Filtering, ordering, paging of Media Services entities](entities-overview.md).

## Next steps

* [Use AES-128 dynamic encryption and the key delivery service](protect-with-aes128.md)
* [Use DRM dynamic encryption and license delivery service](protect-with-drm.md)
* [EncodeHTTPAndPublishAESEncrypted](https://github.com/Azure-Samples/media-services-v3-dotnet-core-tutorials/tree/master/NETCore/EncodeHTTPAndPublishAESEncrypted)
