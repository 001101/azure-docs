---
# Mandatory fields.
title: Manage endpoints and routes using Azure portal
titleSuffix: Azure Digital Twins
description: See how to set up and manage endpoints and event routes for Azure Digital Twins data using Azure portal.
author: v-lakast
ms.author: v-lakast # Microsoft employees only
ms.date: 7/22/2020
ms.topic: how-to
ms.service: digital-twins

# Optional fields. Don't forget to remove # if you need a field.
# ms.custom: can-be-multiple-comma-separated
# ms.reviewer: MSFT-alias-of-reviewer
# manager: MSFT-alias-of-manager-or-PM-counterpart
---

# Manage endpoints and routes in Azure Digital Twins using Azure portal

In Azure Digital Twins, you can route [event notifications](how-to-interpret-event-data.md) to downstream services, or to connect to compute resources. This route can be created by first setting up **endpoints** that can receive the events. You can then create [**event routes**](concepts-route-events.md) that specify which events generated by Azure Digital Twins are delivered to which endpoints.

This article walks you through the process of creating endpoints and routes in [Azure portal](https://portal.azure.com).

## Create an endpoint for Azure Digital Twins

### Prerequisites
* Create Azure account and login to [Azure portal](https://portal.azure.com).
* [Set up instance](how-to-set-up-instance.md) in Azure Digital Twins.

If you have an instance set up earlier, you can search for your instance in the search bar of the portal.
 
:::image type="content" source="media/how-to-manage-routes-portal/search-field-portal.png" alt-text="ADT Instance details":::

From the results, select your instance and you'll land on the following page showing the details of your instance. 

:::image type="content" source="media/how-to-manage-routes-portal/ADT-instance-details.png" alt-text="ADT Instance details":::

You can create endpoints for your instance

Supported endpoint types include:
* [Event Grid](../event-grid/overview.md) 
* [Event Hub](../event-hubs/event-hubs-about.md)
* [Service Bus](../service-bus-messaging/service-bus-messaging-overview.md)

#### To create an endpoint type **Event Grid**:
**Prerequisite**
* Create Event Grid Topic by referring to [this](https://docs.microsoft.com/azure/event-grid/custom-event-quickstart-portal#create-a-custom-topic) link  

On the left navigation bar, select _Endpoints_ and then select _+ create an endpoint_. On the page that opens up, you can create your endpoint of type _Event Grid_ by selecting the radio button. 
Choose endpoint name in the _Name_ field and then select your _Subscription_ and _Event Grid Topic_ from the dropdown.

Then, create endpoint by clicking _save_ button.

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-EventGrid-type.png" alt-text="Create end point of type event grid":::

Verify that the endpoint is successfully created by checking notifications on the top right of the window. You can also view the endpoint created on the Endpoints page with name, status, and type of the endpoint.

If creation of an endpoint fails, retry after a few minutes.

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-notifications.png" alt-text="Notification to verify ":::

#### To create an endpoint type **Event Hub**

**Prerequisites**: 
* You'll need _Event hub namespace_. Refer to [this] (https://docs.microsoft.com/azure/service-bus-messaging/service-bus-create-namespace-portal) link to create an event hub namespace
* You'll need _Event Hub_. Refer to [this](https://docs.microsoft.com/azure/event-hubs/event-hubs-create) article to create an event hub. 
* You'll need _Authorization rule_. Refer to [this](https://docs.microsoft.com/azure/event-hubs/authorize-access-shared-access-signature) article to create Authorization rule.

Search for your Azure Digital Twins instance by typing the resource name in the top search bar in the Azure portal. From the results, select your resource to create an endpoint of type Event Hub.

Select _Endpoints_  from the navigation bar on the left and then click on _+ Create an endpoint_. It opens up _Create an endpoint_ window on the right. 
Select _Event Hub_ radio button to create an endpoint type Event Hub.
Choose an end-point name of your choice in the _Name_ field. Then, select _Subscription_, _Event Hub_, _Authorization rule_ from the respective dropdowns.

Select _save_ button to save your details. 

:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-EventHub-type.png" alt-text="Create end point of type event hub":::

Verify that the endpoint is successfully created by checking the notification icon on the top-right corner of the window. If the creation fails, retry creating an endpoint.

#### To create an endpoint type **Service Bus**

**Prerequisites**: 
* You'll need _Service Bus namespace_. Refer to [this](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-create-namespace-portal) article to create name space
* You'll need _Service Bus topic_. Refer to [this](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-quickstart-topics-subscriptions-portal) article to create a topic
* You'll need _Authorization rule_. Refer to [this](https://docs.microsoft.com/azure/event-hubs/authorize-access-shared-access-signature) article to set your authorization rule 

Search for your Azure Digital Twins instance in the top search bar of the Azure portal. From the results, select your instance to create an endpoint of type Service Bus.

Select _Endpoints_ link on the left navigation bar and then click on _+ Create an endpoint_. It opens up _Create an endpoint_ page on the right. 
Select _Service Bus_ radio button to create an endpoint type Service Bus.
Choose an end-point name of your choice in the _Name_ field. Then, select _Subscription_, _Event Hub_, _Authorization rule_ from the respective dropdowns.

Select _save_ button to save your details. 


:::image type="content" source="media/how-to-manage-routes-portal/create-endpoint-servicebus-type.png" alt-text="Create end point of type service bus":::

Verify that the endpoint is successfully created by checking the notification icon on the top-right corner of the window. If the creation fails, retry creating an endpoint after a few minutes.

For more information on the different endpoints, see [Choose between Azure messaging services](https://docs.microsoft.com/azure/event-grid/compare-messaging-services).

## Manage event routes with APIs

To actually send data from Azure Digital Twins to an endpoint, you need to define an event route. Azure Digital Twins **EventRoutes APIs** let developers wire up event flow, throughout the system and to downstream services. Read more about event routes in [*Concepts: Routing Azure Digital Twins events*](concepts-route-events.md).

Event routes are defined using data plane APIs. A route definition can contain these elements:
* The route ID you want to use
* The name of the endpoint you want to use
* A filter that defines which events are sent to the endpoint 

**Prerequisites**: 
* You'll need endpoints to set up an event route. Refer to _Create an endpoint for Azure Digital Twins_ portion of this article to create endpoints
* You need to be an 'owner' in your Azure subscription. For more details on getting and assigning permissions, refer _Prerequisites:Permission_ requirements section of [*how-to: set-up-instance*](how-to-set-up-instance.md)

>[!NOTE]
>If you have recently deployed your endpoints, validate that they're finished deploying **before** attempting to use them for a new event route. If route deployment fails because the endpoints aren't ready, wait a few minutes and try again.
>
> If you are scripting this flow, you may want to account for this by building in 2-3 minutes of wait time for the endpoint service to finish deploying before moving on to route setup.

If there is no route ID, no messages are routed outside of Azure Digital Twins. 
If there is a route ID and the filter is `true`, all messages are routed to the endpoint. 
If there is a route ID and a different filter is added, messages will be filtered based on the filter.
One route should allow multiple notifications and event types to be selected. 

Create an event route by selecting _Event routes_ from the navigation bar on the left. Then, select _+ Create an event route_ link, that opens up to a window 'Create an event route' on the right. 
Choose event route name of your choice in the _Name_ field, then select the _Endpoint_ you would like to use to create route from the dropdown.

To _Add an event route filter_, you can check the _event types_ from the checkboxes and save your details by selecting _save_ button. 
This will auto populate the filter events that you can see as 'type = 'Microsoft.DigitalTwins.Twin.Create'. Hit _save_ button to create event route.

:::image type="content" source="media/how-to-manage-routes-portal/create-event-route-regular.png" alt-text="Create event route for your instance":::

To create an event route with advanced filter options, you'll need to use the toggle button for the _Advanced editor_ to enable it. You can then customize event types by using filter options mentioned in the supported route filters table below.

:::image type="content" source="media/how-to-manage-routes-portal/create-event-route-advanced-filter.png" alt-text="Create event route for your instance-using advanced filter options":::

Here are the supported route filters.
[!INCLUDE [Filters](../../includes/digital-twins-route-filters.md)]

## Monitor event routes

Routing metrics such as count, latency, and failure rate can be viewed in the [Azure portal](https://portal.azure.com/). 

From the portal homepage, search for your Azure Digital Twins instance to pull up its details. Select the **Metrics** option from the Azure Digital Twins instance's navigation bar on the left to bring up the *Metrics* page.
From here, you can view the metrics for your instance and create custom views.

:::image type="content" source="media/how-to-manage-routes-portal/metrics.png" alt-text="View the metrics of your instance":::

## Next steps

Read about the different types of event messages you can receive:
* [*How-to: Interpret event data*](how-to-interpret-event-data.md)
