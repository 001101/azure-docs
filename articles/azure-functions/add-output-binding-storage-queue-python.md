---
title: Add an Azure Storage queue binding to your Python function 
description: Learn how to add an Azure Storage queue output binding to your Python function using the Azure CLI and Functions Core Tools.
services: functions 
keywords: 
author: ggailey777
ms.author: glenga
ms.date: 04/24/2019
ms.topic: quickstart
ms.service: azure-functions
ms.custom: mvc
ms.devlang: python
manager: jeconnoc
---

# Add an Azure Storage queue binding to your function

In Azure Functions, input and output bindings provide a declarative way of connecting to data sources from within the function definition. This article shows you how to add an Azure Storage queue output binding to the function you created in the [previous quickstart article](functions-create-first-function-python.md).

The function writes the data sent in the HTTP request to a connected Azure Storage queue. To make it easier, you use the Storage account that you created with your function app. The connection to this account is stored in an app setting named `AzureWebJobsStorage`.  

## Prerequisites

To complete this article:

* Complete the [part 1 of the Python quickstart](functions-create-first-function-python.md).
* Install [Microsoft Azure Storage Explorer](https://storageexplorer.com/). This is a tool you'll use to examine queue messages generated by your output binding.

## Download the function app settings

In the previous quickstart article, you created a function app in Azure along with a Storage account. In this article, you write messages to a Storage queue in the same account. To be able to test the function locally, run the following Azure Functions Core Tools command to download settings to the local.settings.json file. 

> [!NOTE]
> Because it contains secrets, the local.settings.json file never gets published, and it should be excluded from source control.

## Add an output binding

In Functions, each type of binding requires a `direction`, `type` and a unique `name` to be defined in the function.json file. Depending on the binding type, additional properties may be required. The [queue output configuration](functions-bindings-storage-queue.md#output---configuration) describes the fields required for an Azure Storage queue binding.

To create a binding you just add a binding configuration object to the `function.json` file. Edit the function.json file in your HttpTrigger folder to add an object to the `bindings` array that has the following properties:

| Property | Value | Description |
| -------- | ----- | ----------- |
| **`name`** | `msg` | Name that identifies the binding parameter referenced in your code. |
| **`type`** | `queue` | The binding is an Azure Storage queue binding. |
| **`direction`** | `out` | The binding is an output binding. |
| **`queueName`** | `outqueue` | The name of the queue that the binding writes to. When the *queueName* doesn't exist, the binding creates it on first use. |
| **`connection`** | `AzureWebJobsStorage` | The name of a app setting that contains the connection string for the Storage account. The `AzureWebJobsStorage` setting contains the connection string for the Storage account you created with the function app. |

Your function.json file should now look like the following example:

```json
{
  "scriptFile": "__init__.py",
  "bindings": [
    {
      "authLevel": "function",
      "type": "httpTrigger",
      "direction": "in",
      "name": "req",
      "methods": [
        "get",
        "post"
      ]
    },
    {
      "type": "http",
      "direction": "out",
      "name": "$return"
    },
	{
      "type": "queue",
      "direction": "out",
      "name": "msg",
      "queueName": "outqueue",
      "connection": "AzureWebJobsStorage"
    }
  ]
}
```

## Add code that uses the output binding

Once its configured, you can start using the `name` of the binding to access it as a method attribute in the function signature. In the following example, _msg_ is an instance of the [azure.functions.InputStream class](/python/api/azure-functions/azure.functions.httprequest).

```python
import logging

import azure.functions as func


def main(req: func.HttpRequest, msg: func.Out[func.QueueMessage]) -> str:

    name = req.params.get('name')
    if not name:
        try:
            req_body = req.get_json()
        except ValueError:
            pass
        else:
            name = req_body.get('name')

    if name:
        msg.set(name)
        return func.HttpResponse(f"Hello {name}!")
    else:
        return func.HttpResponse(
             "Please pass a name on the query string or in the request body",
             status_code=400
        )
```

You are now ready to republish your changes to your function app in Azure. Note that you didn't have to write code for tasks such as authenticating to your storage account, getting a reference to the queue or using the SDK methods to write to it. The Azure Functions runtime and queue output binding take care of those tasks for you. 

## Add the Storage binding extension

```bash
func extensions install
```

## Run the function locally


## Publish to Azure

Using the Azure Functions Core Tools, run the following command. Replace `<app_name>` with the name of the app from the previous article.

```bash
func azure functionapp publish <app_name>
```

You will see output similar to the following. (Note that the entire output has been truncated for readability.)

```output
Getting site publishing info...
...

Preparing archive...
Uploading content...
Upload completed successfully.
Deployment completed successfully.
Syncing triggers...
Functions in <app_name>:
    HttpTrigger - [httpTrigger]
        Invoke url: https://<app_name>.azurewebsites.net/api/httptrigger?code=<function_key>
```

Test the functions running in Azure using cURL. You'll need to change the URL from the sample below to match the App Name and Function Key for your own app. 

```bash
curl -w '\n' 'https://<app_name>.azurewebsites.net/api/httptrigger?code=<function_key>&name=AzureFunctions'
```

## Verify in the Azure portal

**TBD**

[!INCLUDE [functions-cleanup-resources](../../includes/functions-cleanup-resources.md)]

## Next steps

You've added an Azure Storage queue output binding to your HTTP triggered function, deployed your changes to Azure and verified the results of a sample execution. 

Learn more about developing Azure Functions using Python:

> [!div class="nextstepaction"]
> [Azure Functions Python developer guide](functions-reference-python.md)
> [Azure Functions triggers and bindings](functions-triggers-bindings.md)
