---
title: Add an Azure Storage queue binding to your Python function 
description: Learn how to add an Azure Storage queue output binding to your Python function using the Azure CLI and Functions Core Tools.
services: functions 
keywords: 
author: ggailey777
ms.author: glenga
ms.date: 04/24/2019
ms.topic: quickstart
ms.service: azure-functions
ms.custom: mvc
ms.devlang: python
manager: jeconnoc
---

# Part 2: Add an Azure Storage queue binding to your function

In Azure Functions, input and output bindings provide a declarative way of connecting to data sources from within the function definition. This article shows you how to add an Azure Storage queue output binding to an HTTP triggered function. You use the function created in the [first part of the quickstart](functions-create-first-function-python.md). 

The function writes the string content sent in the request to connected Queue storage. To learn more about Azure Storage queues, see the (Azure Storage Overview)[../storage/common/storage-introduction].

To make it easier, you use the Storage account that you created with your function app. The connection is stored in an app setting named `AzureWebJobsStorage`.  

## Prerequisites

To complete this article:

* Complete the [part 1 of the Python quickstart](functions-create-first-function-python.md).
* Install [Microsoft Azure Storage Explorer](https://storageexplorer.com/). This is a tool you'll use to examine queue messages generated by your output binding.

## Create and configure an Azure Storage queue

This example uses the storage account created in the first part of the quickstart. Run the following command to obtain the connection string for your account and save it as an environment variable. 

```bash 
export storageconnectionstring=$(az storage account show-connection-string \
                -g myResourceGroup -n <storage_name> \
                --query connectionString \
                --output tsv)
```

Run the following command to create a queue named `myqueue` in your storage account.

```bash
az storage queue create --name myqueue --connection-string $storageconnectionstring
```

You're now ready to bind your function to this queue.

## Add an output binding

First step to create a binding is to add it's configuration to the `function.json` file. At a minimum, each type of binding requires a `direction`, `type` and a unique `name` to be defined. Depending on the binding type, additional properties may be required. The [queue output configuration](functions-bindings-storage-queue.md#output---configuration) describes the fields required for an Azure Storage queue binding.

This example uses _msg_ as the unique `name` of the binding and _myqueue_ as the `queueName`. Additionally, a `connection` string is required for your storage account. You can point this field to the _storageconnectionstring_ environment variable created earlier. 

```json
{
  "scriptFile": "__init__.py",
  "bindings": [
    ...
    {
      "type": "queue",
      "direction": "out",
      "name": "msg",
      "queueName": "myqueue",
      "connection": "storageconnectionstring"
    }
  ]
}
```

## Add the Storage binding extension

```bash
func extensions install
```

## Add code that uses the output binding

Once its configured, you can start using the `name` of the binding to access it as a method attribute in the function signature. In the following example, _msg_ is an instance of the [azure.functions.InputStream class](/python/api/azure-functions/azure.functions.httprequest).

```python
import azure.functions as func

def main(req: func.HttpRequest, msg: func.InputStream) -> func.HttpResponse:
    ...
    ...
```

You can use the Out method to set the value of this attribute, and as a result of the output binding.

```python

def main(req: func.HttpRequest, msg: func.InputStream) -> func.HttpResponse:
    ...
    ...

    if name:
        return func.HttpResponse(f"Hello {name}!")
    else:
        return func.HttpResponse(
             "Please pass a name on the query string or in the request body",
             status_code=400
        )

```

You are now ready to republish your changes to your function app in Azure. Note that you didn't have to write code for tasks such as authenticating to your storage account, getting a reference to the queue or using the SDK methods to write to it. The Azure Functions runtime and queue output binding take care of those tasks for you. 

## Publish to Azure

Using the Azure Functions Core Tools, run the following command. Replace `<app_name>` with the name of the app from the previous article.

```bash
func azure functionapp publish <app_name>
```

You will see output similar to the following. (Note that the entire output has been truncated for readability.)

```output
Getting site publishing info...
...

Preparing archive...
Uploading content...
Upload completed successfully.
Deployment completed successfully.
Syncing triggers...
Functions in <app_name>:
    HttpTrigger - [httpTrigger]
        Invoke url: https://<app_name>.azurewebsites.net/api/httptrigger?code=<function_key>
```

Test the functions running in Azure using cURL. You'll need to change the URL from the sample below to match the App Name and Function Key for your own app. 

```bash
curl -w '\n' 'https://<app_name>.azurewebsites.net/api/httptrigger?code=<function_key>&name=AzureFunctions'
```

## Verify in the Azure portal

**TBD**

[!INCLUDE [functions-cleanup-resources](../../includes/functions-cleanup-resources.md)]

## Next steps

You've added an Azure Storage queue output binding to your HTTP triggered function, deployed your changes to Azure and verified the results of a sample execution. 

Learn more about developing Azure Functions using Python:

> [!div class="nextstepaction"]
> [Azure Functions Python developer guide](functions-reference-python.md)
> [Azure Functions triggers and bindings](functions-triggers-bindings.md)
