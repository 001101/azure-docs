---
title: Azure Functions Event Grid local debugging
description: Learn to locally debug Azure functions triggered by an Event Grid event
services: functions
documentationcenter: na
author: craigshoemaker
manager: jeconnoc
keywords: azure functions, functions, serverless architecture

ms.service: azure-functions
ms.devlang: multiple
ms.topic: reference
ms.date: 10/18/2018
ms.author: cshoe
---

# Azure Function Event Grid Trigger Local Debugging

This article demonstrates how debug a local function that handles an Azure Event Grid event raised by a storage account. 

## Prerequisites

- Download [ngrok](https://ngrok.com/) to allow Azure to call your local function

## Create a function app

To begin, create a new function app that responds to an Event Grid event.  Open Visual Studio and select **File > New > Project**.

In the *New Project* window open the template pane to **Other Languages > Visual C# > Cloud** and select **Azure Functions**. 

![Create new function app](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-create-new-project.png)

Give your project a name and click **OK**.

In the *New Project* window, select **Empty** and click **OK**.


![Select function type](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-select-type.png)

Next, right-click on the project name in the Solution Explorer and click **Add > New Azure Function**.

In the *New Azure Function* window select **Event Grid trigger** and click **OK**.

![Create new function](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-add-function.png)

Once the function is created, open the code file and copy the URL commented out at the top of the file. This location is used when configuring the Event Grid trigger.

![Copy location](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-copy-location.png)

Then, set a breakpoint on the line that begins with `log.LogInformation`.

![Set breakpoint](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-set-breakpoint.png)


Next, **press F5** to start a debugging session.

## Allow Azure to call your local function

To break into a function being debugged on your machine, you must enable a way for Azure to communicate with your local function from the cloud.

The [ngrok](https://ngrok.com/) utility provides a way for Azure to call the function running on your machine. Start *ngrok* using the following command:

```bash
ngrok http -host-header=localhost 7071
```
As the utility is set up the command window will look similar to the following screenshot:

![Start ngrok](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-ngrok.png)

Copy the **HTTPS** URL generated when *ngrok* is run. This value is used when configuring the event grid event endpoint.

 ## Create a storage account

Next, [create a new storage account](../storage/common/create-accound.md) and name it **functionlocaldebug**. Once the account is created, click on the **Events** option to create a new event subscription.

![Add storage account event](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-add-event.png)

In the *Events* window, click on the **\+ Event Subscription** button to create a new event subscription. In the Even Subscription window, click on the **Endpoint Type** dropdown and select **Web Hook**.

![Select subscription type](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-type.png)

Once you have configured the endpoint type, click on **Select an endpoint** to configure the endpoint value.

![Select endpoint type](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-endpoint.png)

The Subscriber Endpoint value is made up from three different values. The prefix is the HTTPS URL generated by *ngrok*, remainder of the URL comes from the URL found in the function code file and the final part is the function name. Starting with the URL from the function code file, the *ngrok* URL replaces `http://localhost:7071` and the function name replaces `{functionname}`.

The following screenshot depicts how the final URL should look:

![Endpoint selection](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-endpoint-selection.png)

Once you have entered the appropriate value, click **Confirm Selection**.

**Note:** Every time you start *ngrok*, the HTTPS URL is regenerated and the value changes. Therefore you must create a new Event Subscription each time you expose your function to Azure via *ngrok*.

## Upload a file

Now you can upload a file to your storage account in order to trigger an Event Grid event for your local function to handle. 

Open [Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) and connect to the **functionlocaldebug** account. 

- Expand **Blob Containers** 
- Right-click and select **Create Blob Container**.
- Name the container **test**
- Select the test container
- Click the **Upload** button
- Click **Upload Files**
- Select a file and upload it to the blob container

## Debug the function

Once the Event Grid recognizes there is a new file uploaded to the storage container, 

![Start ngrok](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-breakpoint.png)



## Clean up resources

To clean up the resources created in this article, delete the **functionlocaldebug** storage account.



