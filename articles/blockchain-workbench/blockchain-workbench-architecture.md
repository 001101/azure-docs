---
title: Azure Blockchain Workbench architecture
description: Overview of Azure Blockchain Workbench architecture.
services: azure-blockchain
keywords: 
author: PatAltimore
ms.author: patricka
ms.date: 4/4/2018
ms.topic: article
ms.service: azure-blockchain
ms.reviewer: zeyadr
manager: femila
---
# Azure Blockchain Workbench architecture

## Automated Deployment using Azure Resource ManagerTemplates

Azure Blockchain Workbench delivers repeatable and consistent deployments using an Azure Resource Manager template made available as a solution template in the Azure Marketplace. The template allows users to pick the modules/components to deploy with Azure Blockchain Workbench, such as blockchain stack, type of client application, and support for IoT integration. Once deployed, Azure Blockchain Workbench provides access to a Web App, iOS App, and/or Android App. In the future, the deployment solution will provide a-la-carte capability, which will allow users to selectively choose what capabilities they would like to deploy. 

## Azure Active Directory for Identity and Authentication

Once Azure Blockchain Workbench is deployed, users can interact with Azure Blockchain Workbench either via the client applications, REST-based client API, or messaging API. In all cases, interactions must be authenticated, either via Azure Active Directory or device-specific credentials. 
Users typically federate their identities to a consortium Azure Active Directory by sending an email invitation to participants at their email address. When logging in, these users are authenticated using the name, password, and policies, For example, two-factor authentication, of their organization. 
AAD is used to manage all users who have access to Azure Blockchain Workbench. Each device connecting to a smart contract is also associated with AAD. 
AAD is also used to assign users to a special administrator group. Users associated with the administrator group gain administrator rights/actions within Azure Blockchain Workbench, such as deploying contracts and giving permissions to a user to access a contract. Users outside this group do not have access to administrator actions. 

## Client Applications

The provided web and mobile applications deliver the same core functionality. They deliver a user-facing front end to the end to end blockchain applications generated by Azure Blockchain Workbench. Client applications authenticate users via AAD and then present a user experience tailored to the business context of the smart contract. The user experience enables the creation of new smart contract instances by authorized individuals and then presents the ability to execute certain types of transactions at appropriate points in the business process the smart contract represents. 
In the web application, authorized users can access the Administrator Console. This console, made available to users in the Administrator group in AAD, provides access to the following functionality:
•	Deploy Microsoft provided smart contracts for popular scenarios, For example, Asset Transfer.
•	Upload and deploy their own smart contracts.
•	Assign a user access to the smart contract in the context of a specific role.
The provided applications all interact within the client apps go through the Gateway Service API. 

## Gateway Service API

The Gateway Service API is a REST-based API, which is automatically deployed with Azure Blockchain Workbench. For API methods intended to write to the blockchain, the API generates and delivers messages to an event broker. When data is requested by the API, queries are sent to the off-chain SQL database. The SQL database contains two types of data – a replica of on chain data and meta-data that provides context and configuration information for supported smart contracts. Queries return the required data from the off-chain replica in a format informed by the meta-data for the contract. 
Developers can access the Gateway Service API to build or integrate blockchain solutions without relying on Azure Blockchain Workbench client apps.
Note, to enable authenticated access to the API, two client applications are registered in AAD. The reason two are registered is AAD requires distinct application registrations for web and native, For example, mobile, applications. 

## Message Broker for Incoming Messages Intended for the Blockchain

In the current implementation, messages intended to deliver information to the blockchain are delivered via Event Hub. 
Developers not wanting to use the Gateway Service API, such as in a headless system to system integration, can send messages directly to the Event Hub.
Note, there is agreement to change the associated technology from Event Hub to Service Bus.

## Message Broker for Event Messages Intended for Downstream Consumers

During the lifecycle of the application, there are times where events will occur, either triggered by the Gateway API or on the ledger, which are of interest to downstream code that will in turn, consume and act based on these events.
Azure Blockchain Workbench automatically deploys two types of event consumers. One is triggered by blockchain events to populate the off-chain SQL store. The other is to capture meta-data for events generated by the API related to the upload and storage of documents. 

## Message Consumer for DLT-targeted Messages

This standalone service consumes messages from an inbound message broker. These messages contain the metadata for transactions, which have been requested to be written to the blockchain. The consumer retrieves the messages and pushes the data to a transaction builder, signer, and router. 
Message Consumers for Messages Intended for DB and Storage Capabilities
There are two standalone services for consuming messages from the outbound message broker:

1. Database Consumer – This consumer takes messages from Event Hub and pushes the data to an attached database, such as SQL database. 
2. Storage Consumer – This consumer takes messages from Event Hub and pushes data, such as storing hashed documents, to an attached storage, such as Azure Storage. 
These two consumers are abstractions for SQL and storage capabilities. Customers could choose to replace the provided versions to use variants of their own, For example, use a SQL Consumer that populated PostgreSQL vs. SQL DB or used IPFS vs. Azure Storage.
While these two consumers are included as part of the standard deployment to deliver core functionality, the underlying eventing model allows for straightforward extensions for other types of services and systems, For example, add support to populate CosmosDB or evaluate messages using Azure Streaming Analytics. 

## Transaction Builder and Signer

If a message on the inbound message broker needs to be written to the blockchain, it will be picked up by the DLT consumer. The DLT consumer is a service, which retrieves the message containing metadata for a desired transaction to execute and then sends the information to the Transaction Builder and Signer. The Transaction Builder and Signer assembles a blockchain transaction based on the data and the desired blockchain destination. Once assembled, the transaction will then be signed. Private keys are stored in Azure Key Vault. 
Currently, Azure Key Vault does not support hardware or software signing of blockchain transactions within Key Vault. Instead, Azure Blockchain Workbench retrieves the appropriate private key from Key Vault and signs the transaction outside of Key Vault. In the future, blockchain transaction signing will happen within Key Vault. Once signed, the transaction is sent to Transaction Routers and Ledgers. 

## Transaction Routers and Ledgers

Transaction Routers and Ledgers take signed transactions and route them to the appropriate blockchain. Currently, Azure Blockchain Workbench supports Ethereum and Hyperledger Fabric as target blockchains. 

## DLT Watcher

A DLT Watcher monitors events occurring on blockchains attached to Azure Blockchain Workbench. Events reflect information relevant to individuals and systems, such as the creation of new contract instances, execution of transactions, changes of state, etc. These events are captured and sent to the outbound message broker, so they can be consumed by downstream consumers. 
For example, the SQL Consumer monitors events, consumes them, and populates the SQL database with the included values. This enables the creation of a replica of on chain data in an off-chain store.

## SQL DB

The SQL DB attached to Azure Blockchain Workbench stores contract definition and configuration metadata and a SQL-accessible replica of data stored in the blockchain. This data can easily be queried, visualized, or analyzed by directly accessing the database, which means developers and other users can use the database for reporting, analytics or other data-centric integrations. For example, users can visualize transaction data using Power BI. 
This off-chain storage provides significant value as the data personnel of Enterprise organizations have SQL experience and typically do not have a background in blockchain technology or its APIs. Also, by standardizing on a standard schema that’s agnostic of blockchain technology stacks, the off-chain storage enables the reuse of reports and other artifacts across projects, scenarios, and organizations.
Azure Storage
Azure Storage is used to store contracts and metadata associated with contracts.
From purchase orders and bills of lading, to images used in the news and medical imagery, to video originating from a continuum including police body cameras and major motion pictures, documents play a role in many blockchain-centric scenarios. Documents are not, however, appropriate to place directly on the blockchain. 
Azure Blockchain Workbench supports the ability to add documents or other media content with blockchain business logic. A hash of the document or media content is stored in the blockchain and the actual document or media content is stored in Azure Storage. The associated transaction information is delivered to the inbound message broker, packaged up, signed, and routed to the blockchain. This process triggers events, which are shared via the outbound message broker. The SQL DB consumes this information and sends it to the DB for later querying. Downstream systems could also consume these events to act as appropriate.
Application Insights
Application Insights is used to store all logged information from Azure Blockchain Workbench and includes errors, warnings, and successful operations. Application Insights can be used by developers to debug issues with Azure Blockchain Workbench. 

