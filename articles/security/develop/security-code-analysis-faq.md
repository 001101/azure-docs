---
title: Microsoft Security Code Analysis documentation FAQ
description: This article contains an FAQ about the Microsoft Security Code Analysis extension
author: vharindra
manager: sukhans
ms.author: terrylan
ms.date: 07/31/2019
ms.topic: article
ms.service: security
services: azure

ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
---

# Frequently asked questions
Got questions? Check out the FAQ below for more information.

## General

### Can I install the extension on my Visual Studio Team Foundation Server? 

No. The extension isn't available for downloading and installation on Visual Studio Team Foundation Server.

### Do I have to run Microsoft Security Code Analysis with my build? 

Maybe. Depending on the type of analysis tool, the source code or build output might be the only thing that's required.

For example, Credential Scanner (CredScan) analyzes files within the folder structure of the code repository. You can run the CredScan and Publish Security Analysis Logs build tasks in a standalone build to retrieve results.

For other tools like BinSkim that analyze post-build artifacts, the build will be required first.

### Can I break my build when results are found?

Yes, you can introduce a build break when any tool reports an issue or problem in its log file. Just add the Post-Analysis build task and select the checkbox for any tool for which you want to break the build. In the UI of the Post-Analysis task, you can choose to break the build when any tool reports only errors or both errors and warnings.

### How do the command-line arguments in Azure DevOps differ from those in the standalone desktop tools? 

For the most part, the Azure DevOps build tasks are direct wrappers around the command-line arguments of the security tools. Anything you would normally pass to the command-line tool from your desktop you can pass as arguments to the build task.

Noticeable differences:

- The tool runs from the source folder of the agent $(Build.SourcesDirectory) or %BUILD_SOURCESDIRECTORY%. An example is C:\agent\_work\1\s.
- Paths in the arguments can be relative to the root of the source directory previously listed. You can also get absolute paths, either by using Azure DevOps Build Variables or by running an on-premises agent with known deployment locations of local resources.
- By default, tools automatically provide an output file or folder path. If you specify an output location for a build task, the default location is replaced with a path to the well-known location of logs on the build agent
- Some additional command-line arguments are removed for some tools. One example is the option to ensure that no GUI is launched.

### Can I run a build task like Credential Scanner across multiple repositories in an Azure DevOps Build?

No. Running the secure development tools across multiple repositories in a single pipeline is not supported.

### The output file I specified isn't being created, or I can’t find the output file I specified

The build tasks currently filter out some user input. They update the location of the generated output file to be a common location on the build agent. For more information on this location, see the following questions.

### Where are the output files generated by the tools saved? 

The build tasks automatically add output paths to the following well-known location on the build agent: $(Agent.BuildDirectory)\_sdt\logs. By us standardizing on this location, other teams that produce or consume code analysis logs have access to the output.

### Can I queue a build to run these tasks on a hosted build agent? 

Yes. All tasks and tools in the extension can be executed on a hosted build agent.

>[!NOTE]
> The Anti-Malware Scanner build task requires a hosted build agent with Windows Defender enabled. Visual Studio 2017 and later provide such an agent. The build task won't run on the Visual Studio 2015 hosted agent.
>
> Although signatures can't be updated on these agents, signatures should always be less than three hours old.

### Can I run these build tasks as part of a release pipeline as opposed to a build pipeline?

In most cases, yes.

However, Azure DevOps doesn't support running tasks within release pipelines when those tasks publish artifacts.

This lack of support prevents the Publish Security Analysis Logs task from running successfully from a release pipeline. Instead, the task fails with a descriptive error message.

### From where do the build tasks download the tools?

Build tasks download NuGet packages for the tools from the [Azure DevOps Package Management feed](https://securitytools.pkgs.visualstudio.com/_packaging/SecureDevelopmentTools/nuget/v3/index.json). Build tasks also use Node Package Manager, which must be preinstalled on the build agent. An example of such installation is **npm install tslint**.

### What effect does installing the extension have on my Azure DevOps organization? 

Upon installation, the security build tasks provided by the extension becomes available to all users. When you create or edit a pipeline in Azure Pipelines, these tasks are available in the build-task collection list. Otherwise, installing the extension in your Azure DevOps organization has no effect. The installation doesn't modify any account settings, project settings, or pipelines.

### Does installing the extension modify my existing pipelines in Azure Pipelines? 

No. Installing the extension makes the security build tasks available for adding to your pipelines. You are still required to add or update build definitions, so that the tools can work with your build process.

## Task-specific

Questions specific to build tasks are listed in this section.

### Credential Scanner

#### What are common suppressions scenarios and examples?

Two of the most common suppression scenarios are detailed in the following two items.

##### Suppress all occurrences of a given secret within the specified path

The hash key of the secret from the CredScan output file is required as shown in the following sample.

        {
            "tool": "Credential Scanner",
            "suppressions": [
            {
                "hash": "CLgYxl2FcQE8XZgha9/UbKLTkJkUh3Vakkxh2CAdhtY=",
                "_justification": "Secret used by MSDN sample, it is fake."
            }
          ]
        }

>[!WARNING]
> The hash key is generated by a portion of the matching value or file content. Any source code revision could change the hash key and disable the suppression rule.

##### To suppress all secrets in a specified file or to suppress the secrets file itself

The file expression could be a file name or any postfix portion of the full file path or file name. Wildcards are not supported.

The following examples show how to suppress the file  \<InputPath\>\src\JS\lib\angular.js

Examples of valid suppression rules:

- \<InputPath\>\src\JS\lib\angular.js - suppresses the file in the specified path
- \src\JS\lib\angular.js
- \JS\lib\angular.js
- \lib\angular.js
- angular.js - suppress any file with the same name

        {
            "tool": "Credential Scanner",
            "suppressions": [
            {
                "file": "\\files\\AdditonalSearcher.xml", 
                "_justification": "Additional CredScan searcher specific to my team"
            },
            {
                "file": "\\files\\unittest.pfx", 
                "_justification": "Legitimate UT certificate file with private key"
            }
          ]
        }      

>[!WARNING] 
> All future secrets added to the file will also get suppressed automatically.

#### What are recommended guidelines for managing secrets?

It's helpful to detect hard-coded secrets in a timely manner and ti mitigate the risks. But preventing secrets from getting checked in at all is even better.

To help in this regard, Microsoft has released an early preview of Credential Scanner Code Analyzer as part of [Microsoft DevLabs](https://marketplace.visualstudio.com/items?itemName=VSIDEDevOpsMSFT.ContinuousDeliveryToolsforVisualStudio) for Visual Studio. The analyzer gives developers an inline experience for detecting potential secrets in their code. It also gives them the opportunity to fix those issues in real time.

For more information, see the blog post [Managing Secrets Securely in the Cloud](https://devblogs.microsoft.com/visualstudio/managing-secrets-securely-in-the-cloud/).

The following resources help you securely manage secrets and access sensitive information from within your applications.

 - [Azure Key Vault](../../key-vault/index.yml)
 - [Azure Active Directory (Azure AD )](../../sql-database/sql-database-aad-authentication.md)
 - [Azure AD Managed Service Identity](https://azure.microsoft.com/blog/keep-credentials-out-of-code-introducing-azure-ad-managed-service-identity/)
 - [Managed Service Identity for Azure resources](../../active-directory/managed-identities-azure-resources/overview.md)
 - [Azure Managed Service Identity](../../app-service/overview-managed-identity.md)
 - [AppAuthentication Library](../../key-vault/service-to-service-authentication.md)

#### Can I write my own custom searchers?

Credential Scanner relies on a set of content searchers that are commonly defined in the buildsearchers.xml file. The file contains an array of XML serialized objects that represent a **ContentSearcher** object. The program is distributed with a set of well-tested searchers. But you can implement your own custom searchers too.

A content searcher is defined as follows.

- **Name** – The descriptive searcher name to be used in Credential Scanner output files. We recommended you use the camel-case naming convention for searcher names. 
- **RuleId**: The stable opaque ID of the searcher. 
    - Credential Scanner default searchers are assigned **RuleId** values like CSCAN0010, CSCAN0020, and CSCAN0030. The last digit is reserved for merging or dividing potential groups of searcher regular expressions (regex).
    - **RuleId** values for customized searchers should have the form CSCAN-\<Namespace\>\<Number\>. Examples include CSCAN-\<Namespace\>0010, CSCAN-\<Namespace\>0020, and CSCAN-\<Namespace\>0030.
    - The fully qualified searcher name is the combination of the **RuleId** value and the searcher name. Examples are CSCAN0010.KeyStoreFiles and CSCAN0020.Base64EncodedCertificate.
- **ResourceMatchPattern**: Regular expression (regex) of file extensions to check against the searcher.
- **ContentSearchPatterns**: Array of strings containing regex statements to match. If no search patterns are defined, all files matching the resource match pattern will be returned.
- **ContentSearchFilters**: Array of strings containing regex statements to filter searcher-specific false positives.
- **MatchDetails**: A descriptive message, mitigation instructions, or both to be added for each match of the searcher.
- **Recommendation**: Provides the suggestions-field content for a match using PREfast report format.
- **Severity**: An integer to reflect the severity of the issue. The highest severity value is 1.

  ![XML showing Credential Scanner setup](./media/security-tools/6-credscan-customsearchers.png)

### .NET Compiler Platform (Roslyn) Analyzers

#### What are common errors when using the Roslyn Analyzers task?

##### The project was restored using a wrong Microsoft.NETCore.App version

The full error message reads as follows.

"Error: The project was restored using Microsoft.NETCore.App version *x.x.x*, but with current settings, version *y.y.y* would be used instead. To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish. Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore."

Because .NET Compiler Platform (Roslyn) Analyzers tasks run as part of compilation, the source tree on the build machine needs to be in a buildable state. A step between your main build and Roslyn Analyzers steps might have put the source tree in an unbuildable state. This extra step is probably "dotnet.exe publish." Duplicating the step that does a NuGet restoration just before the Roslyn Analyzers step might put the source tree back in a buildable state.

##### "csc.exe" cannot create an analyzer instance

The full error message reads as follows.

"'csc.exe' exited with error code 1 -- An instance of analyzer *AAAA* cannot be created from C:\\*BBBB*.dll : Could not load file or assembly 'Microsoft.CodeAnalysis, Version=*X.X.X.X*, Culture=neutral, PublicKeyToken=31bf3856ad364e35' or one of its dependencies. The system cannot find the file specified."

Ensure your compiler supports Roslyn Analyzers. Running the command `csc /version` should report a version value of at least 2.6.*x*.

Sometimes individual .csproj files can override the build machine's Visual Studio installation by referencing a package from Microsoft.Net.Compilers. If you don't intend to use a specific version of the compiler, remove references to Microsoft.Net.Compilers. Otherwise, make sure the version of the referenced package is also at least v2.6.*x*.

Try to get the error-log path, which is specified in the **/errorlog** option of the **csc** command. The option and path appear in the log for the Roslyn Analyzers build task. The option and path might look something like **/errorlog:F:\ts-services-123\_work\456\s\Some\Project\Code\Code.csproj.sarif**

##### The C# compiler is not recent enough (it must be >= 2.6)

The latest versions of the C# compiler are released here: https://www.nuget.org/packages/Microsoft.Net.Compilers. To get the installed version, run `csc /version` at a command prompt. Ensure that you don't reference a Microsoft.Net.Compilers NuGet package that has a version earlier than 2.6.

##### MSBuild/VSBuild Logs Not Found

The Roslyn build task needs to query Azure DevOps for the MSBuild log from the MSBuild build task. If the task runs immediately after the MSBuild build task, the log will not yet be available. Place other tasks between the MSBuild task and the Roslyn Analyzers build task. Examples include SecDevTools build tasks like BinSkim and Anti-Malware Scanner.

## Next steps

If you need additional assistance, Microsoft Security Code Analysis support is available Monday through Friday from 9:00 AM to 5:00 PM Pacific Standard Time.

  - Onboarding: Contact your Technical Account Managers to get started. 
  
  - Support: Email our team at [Microsoft Security Code Analysis Support](mailto:mscahelp@microsoft.com?Subject=Microsoft%20Security%20Code%20Analysis%20Support%20Request)

  >[!NOTE] 
  >You might not have a paid support relationship with Microsoft. Or you might have a support offering that prevents you from purchasing services from the Phoenix catalog. If either of these conditions is true, please visit our [support services home page](https://www.microsoft.com/enterprise/services/support) for more information.
